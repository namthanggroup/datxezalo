<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒê·∫∑t xe Taxi</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 15px; background: #f8f9fa; }
    h2 { margin-top: 20px; color: #333; }
    .form-group { margin-bottom: 15px; }
    label { display: block; font-weight: bold; margin-bottom: 5px; }
    input, select, textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc;
      border-radius: 8px; font-size: 16px;
    }
    button {
      background: #28a745; color: white; border: none; padding: 12px;
      border-radius: 8px; font-size: 18px; cursor: pointer; width: 100%;
    }
    button:disabled { background: #aaa; }
    .quantity { display: flex; align-items: center; }
    .quantity button {
      width: 40px; height: 40px; font-size: 20px;
      border-radius: 8px; margin: 0 5px;
    }
    .spinner { display: none; margin-top: 10px; text-align: center; }
  </style>
</head>
<body>
  <h1>üöï ƒê·∫∑t xe Taxi</h1>

  <!-- Th√¥ng tin li√™n h·ªá -->
  <h2>Th√¥ng tin li√™n h·ªá</h2>
  <div class="form-group">
    <label>S·ªë ƒëi·ªán tho·∫°i *</label>
    <input type="tel" id="phone" required>
  </div>

  <!-- ƒê·ªãa ch·ªâ -->
  <h2>ƒê·ªãa ch·ªâ</h2>
  <div class="form-group">
    <label>T·ªânh/Th√†nh *</label>
    <select id="province" required>
      <option value="">-- Ch·ªçn T·ªânh/Th√†nh --</option>
    </select>
  </div>
  <div class="form-group">
    <label>Qu·∫≠n/Huy·ªán *</label>
    <select id="district" required>
      <option value="">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>
    </select>
  </div>
  <div class="form-group">
    <label>Ph∆∞·ªùng/X√£ *</label>
    <input type="text" id="ward" placeholder="Nh·∫≠p t√™n ph∆∞·ªùng/x√£" required>
    <div id="ward-suggestions" style="background:#fff;border:1px solid #ccc;display:none;position:absolute;z-index:10;"></div>
  </div>
  <div class="form-group">
    <label>ƒê·ªãa ch·ªâ chi ti·∫øt *</label>
    <input type="text" id="address-detail" required>
  </div>
  <div class="form-group">
    <button type="button" onclick="getLocation()">üìç L·∫•y v·ªã tr√≠ GPS hi·ªán t·∫°i</button>
    <input type="hidden" id="gps">
  </div>

  <!-- Ph∆∞∆°ng ti·ªán -->
  <h2>Th√¥ng tin ph∆∞∆°ng ti·ªán</h2>
  <div class="form-group">
    <label>S·ªë l∆∞·ª£ng xe *</label>
    <div class="quantity">
      <button type="button" onclick="changeQty(-1)">-</button>
      <input type="number" id="qty" value="1" min="1" readonly>
      <button type="button" onclick="changeQty(1)">+</button>
    </div>
  </div>
  <div class="form-group">
    <label>Lo·∫°i xe *</label>
    <select id="car-type" required>
      <option value="">-- Ch·ªçn lo·∫°i xe --</option>
    </select>
  </div>

  <!-- Ghi ch√∫ -->
  <h2>Ghi ch√∫</h2>
  <div class="form-group">
    <textarea id="note" rows="3"></textarea>
  </div>

  <button onclick="submitForm()">G·ª≠i y√™u c·∫ßu</button>
  <div class="spinner" id="spinner">‚è≥ ƒêang x·ª≠ l√Ω...</div>

  <script>
    let locationsData = {};
    let carConfig = {
      "H√† N·ªôi": { "Ba ƒê√¨nh": ["4 ch·ªó", "7 ch·ªó"], "Ho√†n Ki·∫øm": ["4 ch·ªó"] },
      "H·ªì Ch√≠ Minh": { "Qu·∫≠n 1": ["4 ch·ªó", "16 ch·ªó"], "Qu·∫≠n 3": ["4 ch·ªó"] }
    };

    // Load d·ªØ li·ªáu JSON t·ªânh/huy·ªán/x√£
    fetch("locations.json")
      .then(res => res.json())
      .then(data => {
        locationsData = data;
        let provinceSelect = document.getElementById("province");
        Object.keys(data).forEach(prov => {
          let opt = document.createElement("option");
          opt.value = prov; opt.textContent = prov;
          provinceSelect.appendChild(opt);
        });
      });

    // Event change t·ªânh
    document.getElementById("province").addEventListener("change", function() {
      let province = this.value;
      let districtSelect = document.getElementById("district");
      districtSelect.innerHTML = '<option value="">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>';
      if (province && locationsData[province]) {
        Object.keys(locationsData[province]).forEach(dist => {
          let opt = document.createElement("option");
          opt.value = dist; opt.textContent = dist;
          districtSelect.appendChild(opt);
        });
      }
      document.getElementById("car-type").innerHTML = '<option value="">-- Ch·ªçn lo·∫°i xe --</option>';
    });

    // Event change huy·ªán
    document.getElementById("district").addEventListener("change", function() {
      let province = document.getElementById("province").value;
      let district = this.value;
      let wardInput = document.getElementById("ward");
      wardInput.value = "";
      wardInput.dataset.list = JSON.stringify(locationsData[province][district] || []);

      // Load lo·∫°i xe
      let carSelect = document.getElementById("car-type");
      carSelect.innerHTML = '<option value="">-- Ch·ªçn lo·∫°i xe --</option>';
      if (carConfig[province] && carConfig[province][district]) {
        carConfig[province][district].forEach(type => {
          let opt = document.createElement("option");
          opt.value = type; opt.textContent = type;
          carSelect.appendChild(opt);
        });
      }
    });

    // Autocomplete x√£
    document.getElementById("ward").addEventListener("input", function() {
      let list = JSON.parse(this.dataset.list || "[]");
      let val = this.value.toLowerCase();
      let suggestions = list.filter(x => x.toLowerCase().includes(val)).slice(0,5);
      let sugBox = document.getElementById("ward-suggestions");
      sugBox.innerHTML = "";
      if (suggestions.length > 0 && val.length > 0) {
        suggestions.forEach(s => {
          let div = document.createElement("div");
          div.textContent = s;
          div.style.padding = "5px";
          div.onclick = () => { document.getElementById("ward").value = s; sugBox.style.display = "none"; };
          sugBox.appendChild(div);
        });
        sugBox.style.display = "block";
      } else {
        sugBox.style.display = "none";
      }
    });

    // S·ªë l∆∞·ª£ng xe
    function changeQty(delta) {
      let qty = document.getElementById("qty");
      let val = parseInt(qty.value) + delta;
      if (val >= 1) qty.value = val;
    }

    // L·∫•y GPS
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          document.getElementById("gps").value = pos.coords.latitude + "," + pos.coords.longitude;
          alert("ƒê√£ l·∫•y v·ªã tr√≠: " + document.getElementById("gps").value);
        });
      }
    }

    // Submit
    function submitForm() {
      let spinner = document.getElementById("spinner");
      spinner.style.display = "block";
      setTimeout(() => {
        spinner.style.display = "none";
        alert("ƒê·∫∑t xe th√†nh c√¥ng!");
      }, 1500);
    }
  </script>
</body>
</html>
