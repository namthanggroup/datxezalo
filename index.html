<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒê·∫∑t xe Taxi ƒëi·ªán</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-md mx-auto bg-white shadow-lg rounded-2xl p-6 space-y-6">

    <!-- Th√¥ng tin li√™n h·ªá -->
    <div>
      <h2 class="text-lg font-semibold mb-2">üìû Th√¥ng tin li√™n h·ªá</h2>
      <input id="soDienThoai" type="tel" placeholder="S·ªë ƒëi·ªán tho·∫°i *"
        class="w-full p-2 border rounded-lg focus:ring focus:ring-green-300" required>
    </div>

    <!-- ƒê·ªãa ch·ªâ -->
    <div>
      <h2 class="text-lg font-semibold mb-2">üìç ƒê·ªãa ch·ªâ</h2>
      <div class="space-y-2">
        <select id="tinhThanh" class="w-full p-2 border rounded-lg" required>
          <option value="">-- Ch·ªçn T·ªânh/Th√†nh ph·ªë --</option>
        </select>
        <select id="quanHuyen" class="w-full p-2 border rounded-lg" required>
          <option value="">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>
        </select>
        <select id="phuongXa" class="w-full p-2 border rounded-lg" required>
          <option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>
        </select>
        <input id="diaChiChiTiet" type="text" placeholder="ƒê·ªãa ch·ªâ chi ti·∫øt *"
          class="w-full p-2 border rounded-lg focus:ring focus:ring-green-300" required>
        <button type="button" id="btnGPS"
          class="w-full bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600">
          üì° L·∫•y v·ªã tr√≠ GPS hi·ªán t·∫°i
        </button>
        <p id="gpsStatus" class="text-sm text-gray-500 mt-1"></p>
      </div>
    </div>

    <!-- Ph∆∞∆°ng ti·ªán -->
    <div>
      <h2 class="text-lg font-semibold mb-2">üöó Th√¥ng tin ph∆∞∆°ng ti·ªán</h2>
      <div class="flex items-center space-x-2 mb-2">
        <button type="button" id="minusXe"
          class="px-3 py-1 bg-gray-200 rounded-lg">-</button>
        <input id="soLuongXe" type="number" value="1" min="1"
          class="w-16 text-center border rounded-lg">
        <button type="button" id="plusXe"
          class="px-3 py-1 bg-gray-200 rounded-lg">+</button>
      </div>
      <select id="loaiXe" class="w-full p-2 border rounded-lg" required>
        <option value="">-- Ch·ªçn lo·∫°i xe --</option>
      </select>
    </div>

    <!-- Ghi ch√∫ -->
    <div>
      <h2 class="text-lg font-semibold mb-2">üìù Ghi ch√∫</h2>
      <textarea id="ghiChu" rows="3"
        class="w-full p-2 border rounded-lg focus:ring focus:ring-green-300"
        placeholder="Ghi ch√∫ th√™m..."></textarea>
    </div>

    <!-- Submit -->
    <div>
      <button id="submitBtn"
        class="w-full bg-green-500 text-white p-3 rounded-lg font-semibold hover:bg-green-600 flex items-center justify-center">
        <span id="btnText">üöï ƒê·∫∑t xe</span>
        <svg id="loadingSpinner" class="hidden animate-spin h-5 w-5 ml-2 text-white"
          xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8v8H4z"></path>
        </svg>
      </button>
    </div>

  </div>

  <script>
    let locations = {};
    let cauHinhXe = [];

    // Load JSON d·ªØ li·ªáu
    async function loadData() {
      const [locRes, xeRes] = await Promise.all([
        fetch("locations.json").then(r => r.json()),
        fetch("cau_hinh_xe.json").then(r => r.json())
      ]);
      locations = locRes;
      cauHinhXe = xeRes;
      renderTinhThanh();
      prefillData();
    }

    // Render t·ªânh
    function renderTinhThanh() {
      const tinhSelect = document.getElementById("tinhThanh");
      Object.keys(locations).forEach(tinh => {
        tinhSelect.innerHTML += `<option value="${tinh}">${tinh}</option>`;
      });
    }

    // Event ch·ªçn t·ªânh
    document.getElementById("tinhThanh").addEventListener("change", e => {
      const tinh = e.target.value;
      const qhSelect = document.getElementById("quanHuyen");
      const pxSelect = document.getElementById("phuongXa");
      qhSelect.innerHTML = '<option value="">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>';
      pxSelect.innerHTML = '<option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>';
      document.getElementById("loaiXe").innerHTML = '<option value="">-- Ch·ªçn lo·∫°i xe --</option>';

      if (tinh && locations[tinh]) {
        Object.keys(locations[tinh]).forEach(qh => {
          qhSelect.innerHTML += `<option value="${qh}">${qh}</option>`;
        });
      }
    });

    // Event ch·ªçn qu·∫≠n
    document.getElementById("quanHuyen").addEventListener("change", e => {
      const tinh = document.getElementById("tinhThanh").value;
      const quan = e.target.value;
      const pxSelect = document.getElementById("phuongXa");
      pxSelect.innerHTML = '<option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>';

      if (tinh && quan && locations[tinh][quan]) {
        locations[tinh][quan].forEach(px => {
          pxSelect.innerHTML += `<option value="${px}">${px}</option>`;
        });
      }

      // Load lo·∫°i xe theo qu·∫≠n
      const loaiXeSelect = document.getElementById("loaiXe");
      loaiXeSelect.innerHTML = '<option value="">-- Ch·ªçn lo·∫°i xe --</option>';
      cauHinhXe
        .filter(item => item.Tinh_TP === tinh && item.Quan_Huyen === quan)
        .forEach(item => {
          loaiXeSelect.innerHTML += `<option value="${item.Loai_Xe}">${item.Loai_Xe}</option>`;
        });
    });

    // GPS
    document.getElementById("btnGPS").addEventListener("click", () => {
      const gpsStatus = document.getElementById("gpsStatus");
      gpsStatus.textContent = "ƒêang l·∫•y v·ªã tr√≠...";
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          gpsStatus.textContent = `‚úÖ ${pos.coords.latitude}, ${pos.coords.longitude}`;
          localStorage.setItem("toaDo", `${pos.coords.latitude},${pos.coords.longitude}`);
        }, () => {
          gpsStatus.textContent = "‚ùå Kh√¥ng l·∫•y ƒë∆∞·ª£c v·ªã tr√≠";
        });
      } else {
        gpsStatus.textContent = "‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS";
      }
    });

    // +/- s·ªë l∆∞·ª£ng xe
    document.getElementById("plusXe").addEventListener("click", () => {
      let val = parseInt(document.getElementById("soLuongXe").value) || 1;
      document.getElementById("soLuongXe").value = val + 1;
    });
    document.getElementById("minusXe").addEventListener("click", () => {
      let val = parseInt(document.getElementById("soLuongXe").value) || 1;
      if (val > 1) document.getElementById("soLuongXe").value = val - 1;
    });

    // Submit
    document.getElementById("submitBtn").addEventListener("click", async () => {
      const btnText = document.getElementById("btnText");
      const spinner = document.getElementById("loadingSpinner");
      btnText.textContent = "ƒêang g·ª≠i...";
      spinner.classList.remove("hidden");

      const data = {
        soDienThoai: document.getElementById("soDienThoai").value,
        tinh: document.getElementById("tinhThanh").value,
        quan: document.getElementById("quanHuyen").value,
        phuong: document.getElementById("phuongXa").value,
        diaChiChiTiet: document.getElementById("diaChiChiTiet").value,
        soLuongXe: document.getElementById("soLuongXe").value,
        loaiXe: document.getElementById("loaiXe").value,
        toaDo: localStorage.getItem("toaDo") || "",
        ghiChu: document.getElementById("ghiChu").value
      };

      // L∆∞u localStorage
      Object.keys(data).forEach(k => localStorage.setItem(k, data[k]));

      // G·ª≠i Apps Script
      await fetch("YOUR_APPSCRIPT_URL_HERE", {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      });

      btnText.textContent = "üöï ƒê·∫∑t xe";
      spinner.classList.add("hidden");
      alert("‚úÖ ƒê·∫∑t xe th√†nh c√¥ng!");
    });

    // Prefill t·ª´ localStorage
    function prefillData() {
      ["soDienThoai","tinhThanh","quanHuyen","phuongXa","diaChiChiTiet","soLuongXe","loaiXe","ghiChu"].forEach(id => {
        if (localStorage.getItem(id)) {
          document.getElementById(id).value = localStorage.getItem(id);
        }
      });
      if (localStorage.getItem("toaDo")) {
        document.getElementById("gpsStatus").textContent = "üìç " + localStorage.getItem("toaDo");
      }
    }

    loadData();
  </script>
</body>
</html>
